{
  "id":  "5fdfda4f-c4a4-436b-aa73-9cbb6fe8e56a",
  "name":  "Disable Overcommitting Guest Memory in KubeVirt VirtualMachines",
  "description":  "Ensures that all KubeVirt VirtualMachines either do not specify the 'overcommitGuestOverhead' field, or if specified, it must be set to false. If the 'resources' field is missing entirely, the rule passes for that VirtualMachine.",
  "expression":  "virtualmachines.items.all(vm, !has(vm.spec.template.spec.domain.resources) || !has(vm.spec.template.spec.domain.resources.overcommitGuestOverhead) || vm.spec.template.spec.domain.resources.overcommitGuestOverhead == false)",
  "inputs":  [
    {
      "name":  "virtualmachines",
      "kubernetes":  {
        "group":  "kubevirt.io",
        "version":  "v1",
        "resource":  "virtualmachines"
      }
    }
  ],
  "tags":  [
    "generated",
    "ai-assisted"
  ],
  "category":  "security",
  "severity":  "medium",
  "test_cases":  [
    {
      "id":  "test-1",
      "name":  "All VMs without overcommitGuestOverhead",
      "description":  "No VM has the 'overcommitGuestOverhead' field set, or it is set to false.",
      "test_data":  {
        "virtualmachines":  "{\"items\":[{\"metadata\":{\"name\":\"vm1\"},\"spec\":{\"template\":{\"spec\":{\"domain\":{\"resources\":{\"requests\":{\"memory\":\"1Gi\"}}}}}}},{\"metadata\":{\"name\":\"vm2\"},\"spec\":{\"template\":{\"spec\":{\"domain\":{\"resources\":{\"overcommitGuestOverhead\":false,\"requests\":{\"memory\":\"2Gi\"}}}}}}}]}"
      },
      "expected_result":  true
    },
    {
      "id":  "test-2",
      "name":  "VM with overcommitGuestOverhead set to true",
      "description":  "At least one VM has 'overcommitGuestOverhead: true' in its spec.",
      "test_data":  {
        "virtualmachines":  "{\"items\":[{\"metadata\":{\"name\":\"vm3\"},\"spec\":{\"template\":{\"spec\":{\"domain\":{\"resources\":{\"overcommitGuestOverhead\":true,\"requests\":{\"memory\":\"1Gi\"}}}}}}}]}"
      }
    },
    {
      "id":  "test-3",
      "name":  "Empty VM list",
      "description":  "No VirtualMachines present in the cluster.",
      "test_data":  {
        "virtualmachines":  "{\"items\":[]}"
      },
      "expected_result":  true
    },
    {
      "id":  "test-4",
      "name":  "VM missing resources field",
      "description":  "VM present, but 'resources' field is missing entirely.",
      "test_data":  {
        "virtualmachines":  "{\"items\":[{\"metadata\":{\"name\":\"vm4\"},\"spec\":{\"template\":{\"spec\":{\"domain\":{}}}}}]}"
      },
      "expected_result":  true
    }
  ],
  "metadata":  {
    "platforms":  [
      "kubernetes"
    ]
  },
  "created_at":  "1754594493",
  "updated_at":  "1754594493",
  "created_by":  "chat-ui",
  "last_modified_by":  "chat-ui"
}