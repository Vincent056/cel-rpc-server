{"id":"4fa8eaf5-2c0b-4c00-bf69-160c425a310d","name":"Namespace Must Have NetworkPolicy","description":"This rule ensures that every namespace, except for the 'kube-system' namespace, has at least one NetworkPolicy resource defined within it. This helps enforce baseline network segmentation and restricts the default 'allow all' behavior in Kubernetes namespaces.","expression":"namespaces.items.all(ns, ns.metadata.name == \"kube-system\" || networkpolicies.items.exists(np, np.metadata.namespace == ns.metadata.name))","inputs":[{"name":"namespaces","kubernetes":{"version":"v1","resource":"namespaces"}},{"name":"networkpolicies","kubernetes":{"group":"networking.k8s.io","version":"v1","resource":"networkpolicies"}}],"tags":["generated","ai-assisted"],"category":"security","severity":"medium","testCases":[{"id":"test-1","name":"Valid - All namespaces have NetworkPolicy","description":"Each namespace except 'kube-system' has at least one NetworkPolicy.","testData":{"namespaces":"{\"items\":[{\"metadata\":{\"name\":\"default\"}},{\"metadata\":{\"name\":\"dev\"}},{\"metadata\":{\"name\":\"kube-system\"}}]}","networkpolicies":"{\"items\":[{\"metadata\":{\"name\":\"np1\",\"namespace\":\"default\"}},{\"metadata\":{\"name\":\"np2\",\"namespace\":\"dev\"}}]}"},"expectedResult":true},{"id":"test-2","name":"Valid - kube-system exempt","description":"'kube-system' namespace has no NetworkPolicy but is exempt.","testData":{"namespaces":"{\"items\":[{\"metadata\":{\"name\":\"kube-system\"}}]}","networkpolicies":"{\"items\":[]}"},"expectedResult":true},{"id":"test-3","name":"Invalid - Namespace missing NetworkPolicy","description":"A non-kube-system namespace has no NetworkPolicy.","testData":{"namespaces":"{\"items\":[{\"metadata\":{\"name\":\"default\"}},{\"metadata\":{\"name\":\"dev\"}}]}","networkpolicies":"{\"items\":[{\"metadata\":{\"name\":\"np1\",\"namespace\":\"default\"}}]}"}},{"id":"test-4","name":"Edge - No namespaces","description":"Empty cluster (no namespaces at all) should pass (by .all() semantics).","testData":{"namespaces":"{\"items\":[]}","networkpolicies":"{\"items\":[]}"},"expectedResult":true}],"metadata":{"platforms":["kubernetes"]},"isVerified":true,"createdAt":"1753262793","updatedAt":"1753262793","createdBy":"chat-ui","lastModifiedBy":"chat-ui"}