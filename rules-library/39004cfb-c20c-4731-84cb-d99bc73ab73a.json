{
  "id": "39004cfb-c20c-4731-84cb-d99bc73ab73a",
  "name": "Pod Privilege Escalation Prevention",
  "description": "Ensures that all containers in all pods do not have privilege escalation enabled. This means for every container, if the securityContext or privileged fields are missing, or privileged is set to false, the rule passes. Any container with privileged set to true will fail the rule.",
  "expression": "pods.items.all(p, p.spec.containers.all(c, !has(c.securityContext) || !has(c.securityContext.privileged) || c.securityContext.privileged == false))",
  "inputs": [
    {
      "name": "pods",
      "kubernetes": {
        "version": "v1",
        "resource": "pods",
        "namespace": "default"
      }
    }
  ],
  "tags": [
    "generated",
    "ai-assisted"
  ],
  "category": "security",
  "severity": "medium",
  "test_cases": [
    {
      "id": "test-1",
      "name": "Valid - All containers non-privileged",
      "description": "All containers either do not have the privileged field set or have it set to false.",
      "test_data": {
        "pods": "{\"items\":[{\"metadata\":{\"name\":\"pod1\"},\"spec\":{\"containers\":[{\"name\":\"app\",\"securityContext\":{\"privileged\":false}},{\"name\":\"sidecar\"}]}},{\"metadata\":{\"name\":\"pod2\"},\"spec\":{\"containers\":[{\"name\":\"worker\",\"securityContext\":{\"privileged\":false}}]}}]}"
      },
      "expected_result": true
    },
    {
      "id": "test-2",
      "name": "Invalid - Privileged container present",
      "description": "At least one container has privileged set to true.",
      "test_data": {
        "pods": "{\"items\":[{\"metadata\":{\"name\":\"bad-pod\"},\"spec\":{\"containers\":[{\"name\":\"exploit\",\"securityContext\":{\"privileged\":true}}]}}]}"
      }
    },
    {
      "id": "test-3",
      "name": "Edge - No pods",
      "description": "No pods exist in the namespace.",
      "test_data": {
        "pods": "{\"items\":[]}"
      },
      "expected_result": true
    },
    {
      "id": "test-4",
      "name": "Edge - Container with missing securityContext",
      "description": "A container does not have a securityContext field; this should still pass.",
      "test_data": {
        "pods": "{\"items\":[{\"metadata\":{\"name\":\"pod3\"},\"spec\":{\"containers\":[{\"name\":\"app\"}]}}]}"
      },
      "expected_result": true
    }
  ],
  "metadata": {
    "platforms": [
      "kubernetes"
    ]
  },
  "created_at": "1753282727",
  "updated_at": "1753282727",
  "created_by": "chat-ui",
  "last_modified_by": "chat-ui"
}